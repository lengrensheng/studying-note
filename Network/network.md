##Network
---

+ #### WebSocket/Socket/HttpClient
	+ WebSocket: 为了满足基于Web的日益增长的实时通信需求而产生的（解决HTTP协议消耗带宽（HTTP HEAD较大）过大和CPU浪费（没有信息也要接受请求））
	+ OSI模型：一种概念模型，一个试图使各种计算机在世界范围内互连为网络的标准框架。总共由七层组成，从下到上为：
		+ 1. 物理层：机械、电子、定时接口通信信道上的原始比特流传输[`IEEE 802.2/Ethernet v.2`]
		+ 2. 数据链路层：物理寻址，同时将原始比特流转换成逻辑传输线路[`隧道协议、地址解析协议`]
		+ 3. 网络层：控制子网的运行，如逻辑编址、分组传输、路由选择[`路由协议、IP/IPv6协议`]
		+ 4. 传输层：接受上一层的数据，在必要的时候把数据进行分割，并将这些数据交给网络层，且保证这些数据段有效到达对端[`TCP/UDP协议`]
		+ 5. 会话层：不同机器上的用户之间建立及管理会话[`SSL/TLS/RPC/目录访问协议`]
		+ 6. 表示层：信息的语法语义以及它们的关联，如加密解密、转换翻译、压缩解压缩
		+ 7. 应用层：各种应用程序协议。[`HTTP/FTP/POPS/SMTP`]
		
		```
		同时使用TCP和UDP协议的应用层服务
		1. Socks[Sockets简写]:安全套接字协议
		2. DNS：域名系统
		3. SLP服务定位协议
		4. FANP流属性通知协议
		5. 等
		```
		详情如图：
		![OSI七层模型](./images/TCP-IP.gif)
	+ TCP/IP协议族：
		+ 应用层：http/Telnet/Ftp/Email/DNS等协议
		+ 传输层：Tcp/Udp（`TCP协议传输是可靠的`）
		+ 网络层：IP/ICMP/ARP/RAPP/BOOTP等协议
		+ 链路层 ：设备驱动程序及接口卡
	+ TCP协议中的三次握手和四次挥手
		+ TCP Flags
			+ URG：表示TCP包的紧急指针域有效，用来保证TCP连接不被中断。并且督促中间层设备要尽快处理这些数据
			+ ACK：表示应答域有效
			+ PSH：表示PUSH操作——数据包到达接收端后，立即传送给应用程序而不是在缓冲区中排队
			+ RST：表示连接复位请求。用来复位那些产生错误的连接，也被用来拒绝错误和非法的数据包
			+ SYN：表示同步序列号，用来建立连接。SYN标识位和ACK标识位搭配使用
			+ FIN：表示发送端已到达数据末尾。用于断开连接和端口扫描  
		+ 三次握手
			+ 第一次握手：客户端向服务器发送连接请求包，标志位SYN（`同步序号`）位置为1，Seq(`序列号`)为X=0[`客户端发送SYN报文，请求连接`]
			+ 第二次握手：服务器收到客户端发过来的报文，由SYN=1知道客户端要求建立联机。向客户端发送一个SYN和ACK都置为1的TCP报文，设置初始Sqe(`序列号`)Y=0，将确认序号(`ack`)设置为客户的X+1[`服务器收到来自客户端的SYN报文，确认无误后发送SYN+ACK报文`]
			+ 第三次握手：客户端收到服务器发来的包后检查确认序列号(`ack`)是否正确（`即第一次发送的序号+1`）。 以及ACK(`标识位`)是否为1。若正确，客户端再次发送确认包，ACK标志位为1，发送序列号为X+1=1，确认序号为Y+1=1[`客户端收到服务器SYN+ACK报文，确认无误后向服务器发送ACK报文`]
		![TCP三次握手](./images/TCP_Three_Shake_Hands.jpg)
		+ 四次挥手
			+ 第一次挥手：客户端给服务器发送TCP包，用来关闭客户端到服务器的数据传输。将标识位FIN和ACK置为1，序号为X=1，确认序号为Z=1[`可以是客户端也可以是服务器端。主机一向主机二发送FIN报文`]
			+ 第二次挥手：服务器收到FIN后，发回一个ACK=1，确认序列号为收到的序号+1（X=X+1=2）。序列号为收到的确认序号Z[`主机二收到主机一的FIN报文，确认无误后向主机二回一个ACK报文`]
			+ 第三次挥手：服务器关闭与客户端的连接，发送一个FIN。标志位FIN和ACK置为1，序列号为Y=1，确认序列号为X=2[`主机二向主机一发送FIN报文，请求关闭连接`]
			+ 第四次挥手：客户端收到服务器发送的FIN之后，发回ACK确认报文，确认序列号为收到的序列号+1（Y+1=2），序列号为收到的确认序列号X=2[`主机二收到主机一发送的FIN报文，确认无误后向主机二发送ACK报文`] 
		![TCP三次握手](./images/TCP_Four_Wave_Hands.jpg)
		
		+ 需要三次握手的原因（`防止服务器资源浪费`）：客户端发送一个连接请求报文并且没有丢失，而是在某个网络节点长时间的滞留了，以致延误到连接释放以后的某个事件才到服务器端。本来这是一个早已失效的报文段，但是服务器端收到此失效的连接报文请求后，就误认为是客户端再次发出的一个新的连接请求，于是就向客户端发送确认报文，同意建立连接。如果不采用`三次握手`，那么只要服务器端发出确认，新的连接就建立了。此时服务器端则会一直等待客户端发送数据，从而造成了服务器端资源的浪费
		+ 需要四次挥手的原因（`全双工`）：当主机一发出FIN报文段时表示主机一已经没有数据要发送了，但是这个时候主机一还是可以接受来自主机二的数据（`然后主机二发送ACK报文给主机一`）。当主机二也发送FIN报文段时，这个时候表示主机二也没有数据要发送了（`然后主机一发送ACK报文给主机二`），之后TCP连接断开。
	+ Socket：其实并不是一个协议，它工作在OSI模型会话层，是为了方便大家直接使用更低层协议（一般是`TCP`或`UDP`）而存在的一个抽象层
